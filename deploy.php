<?php
// ==========================================
// CONFIG: ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏£‡∏¥‡∏á
// ==========================================
$port = 5000;
$binaryName = "main"; // <--- ‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà Go Build ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏à‡∏∞‡∏ä‡∏∑‡πà‡∏≠ main (‡∏ñ‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∑‡πà‡∏ô ‡πÅ‡∏Å‡πâ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ)

header("Content-Type: text/html; charset=utf-8");
echo "<h2>üöÄ Restarting Server...</h2>";

// ------------------------------------------
// 1. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡πà‡∏≠‡∏ô‡∏ß‡πà‡∏≤‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏´‡∏° (‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡∏î‡πà‡∏≤‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á)
// ------------------------------------------
if (!file_exists($binaryName)) {
    echo "<h3 style='color:red;'>‚ùå Error: ‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏ä‡∏∑‡πà‡∏≠ '$binaryName' ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠!</h3>";
    echo "<b>‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠:</b><br>";
    echo "<pre>" . shell_exec("ls -1") . "</pre>";
    echo "<i>* ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏Å‡πâ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ \$binaryName ‡πÉ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 6 ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô</i>";
    exit();
}

// ------------------------------------------
// 2. ‡∏Ü‡πà‡∏≤ Process ‡πÄ‡∏î‡∏¥‡∏°
// ------------------------------------------
echo "Killing process on port $port...<br>";
shell_exec("fuser -k $port/tcp");
sleep(2);

// 3. ‡πÉ‡∏´‡πâ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÑ‡∏ü‡∏•‡πå
shell_exec("chmod +x $binaryName");

// 4. ‡∏™‡∏±‡πà‡∏á‡∏£‡∏±‡∏ô (‡πÉ‡∏ä‡πâ txt ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢)
echo "Starting application...<br>";
$command = "nohup ./$binaryName > app.txt 2>&1 &";
shell_exec($command);
sleep(1);

echo "<h3>‚úÖ ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏£‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</h3>";

// ------------------------------------------
// 5. ‡∏≠‡πà‡∏≤‡∏ô Log ‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏•‡∏¢ (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î!)
// ------------------------------------------
echo "<hr><b>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå app.txt):</b><br>";
echo "<div style='background: #f4f4f4; padding: 10px; border: 1px solid #ddd;'>";
if (file_exists("app.txt")) {
    $logContent = file_get_contents("app.txt");
    if (empty($logContent)) {
        echo "<i>(‡πÑ‡∏ü‡∏•‡πå‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤ - Server ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏π‡∏ï ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô)</i>";
    } else {
        echo "<pre>" . htmlspecialchars($logContent) . "</pre>";
    }
} else {
    echo "‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå Log";
}
echo "</div>";
?>